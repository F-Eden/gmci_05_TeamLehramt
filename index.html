<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Dozierenden-Übersicht</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
    }
    nav {
      width: 150px;
      background-color: #2c3e50; /* Dunkelblau wie auf Startseite */
      border-right: 1px solid #34495e;
      padding: 1rem;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    
    nav a {
      color: white;
      text-decoration: none;
      padding: 0.8rem 1rem;
      margin: 0.2rem 0;
      border-radius: 4px;
    }
    nav a:hover {
      background-color: #34495e;
    }

    nav a.active {
      background-color: #f1c40f; /* gelb, aktive Farbe */
      font-weight: bold;
      color: black;
    }

    main {
      flex-grow: 1;
      padding: 1.5rem;
      background-color: #ecf0f1;
      overflow-y: auto;
    }
    .btn-new-session {
      display: inline-block;
      background-color: #27ae60;
      color: white;
      padding: 1rem 2rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 2rem;
    }
    .session-list {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      max-height: 70vh;
      overflow-y: auto;
    }
    .session-list h2 {
      margin-top: 0;
    }
    .session-item {
      padding: 0.5rem 0;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .session-item:last-child {
      border-bottom: none;
    }
    .session-item:hover {
      background-color: #dcedc8;
    }
    .session-info {
      flex-grow: 1;
    }
    .session-title {
      font-weight: bold;
    }
    .session-date {
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.2rem;
    }
  </style>
</head>
<body>

  <nav>
    <a href="index.html" class="active">Startseite</a>
    <a href="sessions.html">Sessions</a>
    <a href="#">Auswertung</a>
    <a href="#">Profil</a>
  </nav>

  <main>
    <button class="btn-new-session" onclick="window.location.href='newSession.html'">Eine neue Feedback Session erstellen</button>

    <div class="session-list">
      <h2>Bisherige Sessions</h2>
      <div id="sessionsContainer">
        <!-- Dynamisch hier Sessions aus CouchDB geladen -->
        <p>Lädt Sessions...</p>
      </div>
    </div>
  </main>

  <script>
    const sessionsContainer = document.getElementById('sessionsContainer');

    async function loadSessions() {
      try {
        // VERWENDE _all_docs wie in der Session-Seite
        const response = await fetch('http://localhost:5984/gmci/_all_docs?include_docs=true');
        const data = await response.json();
        
        // Filtere nur Session-Dokumente
        const sessions = data.rows
          .filter(row => row.doc && row.doc.type === "session")
          .sort((a, b) => new Date(b.doc.createdAt) - new Date(a.doc.createdAt))
          .map(row => row.doc);

        if (sessions.length === 0) {
          sessionsContainer.innerHTML = '<p>Keine Sessions gefunden.</p>';
          return;
        }

        sessionsContainer.innerHTML = '';

        sessions.forEach(session => {
          const div = document.createElement('div');
          div.classList.add('session-item');
          
          // Erstelle einen Container für die Session-Informationen
          const infoDiv = document.createElement('div');
          infoDiv.classList.add('session-info');
          
          // Session-Titel
          const titleSpan = document.createElement('span');
          titleSpan.classList.add('session-title');
          titleSpan.textContent = session.title;
          infoDiv.appendChild(titleSpan);
          
          // Datum und Uhrzeit
          const dateSpan = document.createElement('span');
          dateSpan.classList.add('session-date');
          const lastModified = new Date(session.createdAt);
          const formattedTime = lastModified.toLocaleTimeString('de-DE', { 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          const formattedDate = lastModified.toLocaleDateString('de-DE');
          dateSpan.textContent = `(${formattedDate} ${formattedTime})`;
          infoDiv.appendChild(dateSpan);
          
          div.appendChild(infoDiv);
          
          // Klick auf die gesamte Zeile = Bearbeiten
          div.addEventListener('click', () => {
            // Leitet zur Bearbeitungsseite weiter mit Session-ID
            window.location.href = `editSession.html?id=${encodeURIComponent(session._id)}`;
          });
          
          sessionsContainer.appendChild(div);
        });
      } catch (error) {
        sessionsContainer.innerHTML = '<p>Fehler beim Laden der Sessions.</p>';
        console.error('Fehler beim Laden der Sessions:', error);
      }
    }

    window.addEventListener('load', loadSessions);
  </script>
  
</body>
</html>